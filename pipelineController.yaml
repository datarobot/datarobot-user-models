black_check: &black_check
  taskName: black_check
  definition: jenkins/black_check.groovy
  phase: 0

build_drum: &build_drum
  taskName: build_drum
  definition: jenkins/build_drum.groovy
  phase: 1

test_integration_in_a_single_container: &test_integration_in_a_single_container
  taskName: test_integration_in_a_single_container
  definition: jenkins/run_integration_tests_in_a_single_container.groovy
  environment:
    PIPELINE_CONTROLLER: 1
  phase: 2

test_integration_without_container: &test_integration_without_container
  taskName: test_integration_without_container
  definition: jenkins/run_integration_tests_without_container.groovy
  environment:
    PIPELINE_CONTROLLER: 1
  phase: 2

test_inference_model_templates: &test_inference_model_templates
  taskName: test_inference_model_templates
  definition: jenkins/test_inference_model_templates.groovy
  environment:
    PIPELINE_CONTROLLER: 1
  phase: 2

test_training_model_templates: &test_training_model_templates
  taskName: test_training_model_templates
  definition: jenkins/test_training_model_templates.groovy
  environment:
    PIPELINE_CONTROLLER: 1
  phase: 2

test_drop_in_envs: &test_drop_in_envs
  taskName: test_drop_in_envs
  definition: jenkins/test_drop_in_envs.groovy
  environment:
    PIPELINE_CONTROLLER: 1
  phase: 2

repositoryTasks:
  pr:
    phrase:
      - regex: ".*black_check.*"
        script: *black_check
      - regex: ".*build_drum.*"
        script:
          - *black_check
          - *build_drum
      - regex: ".*test_integration_in_a_single_container.*"
        script:
          - *build_drum
          - *test_integration_in_a_single_container
      - regex: ".*test_integration_without_container.*"
        script:
          - *build_drum
          - *test_integration_without_container
      - regex: ".*test_inference_model_templates.*"
        script:
          - *build_drum
          - *test_inference_model_templates
      - regex: ".*test_training_model_templates.*"
        script:
          - *build_drum
          - *test_training_model_templates
      - regex: ".*test_drop_in_envs.*"
        script:
          - *build_drum
          - *test_drop_in_envs
    change:
      - changedFilesRegex: '.*'
        script:
          - *black_check
          - *build_drum
          - *test_integration_without_container
          - *test_integration_in_a_single_container
          - *test_inference_model_templates
          - *test_training_model_templates
          - *test_drop_in_envs
